
SELECT
MID.EQUALITY_COLUMNS
,MID.INEQUALITY_COLUMNS
,MID.INCLUDED_COLUMNS
,MID.STATEMENT AS [DATABASE.SCHEMA.TABLE]
,MIGS.UNIQUE_COMPILES
,MIGS.USER_SEEKS
,MIGS.USER_SCANS
,MIGS.AVG_USER_IMPACT
, 'CREATE NONCLUSTERED INDEX [<NAME OF MISSING INDEX>]' + ' ON ' + MID.STATEMENT + ' (' + ISNULL (MID.EQUALITY_COLUMNS, '') + CASE
    WHEN MID.EQUALITY_COLUMNS IS NOT NULL
    AND MID.INEQUALITY_COLUMNS IS NOT NULL THEN ','
    ELSE ''
  END + ISNULL (MID.INEQUALITY_COLUMNS, '') + ')' + ISNULL (' INCLUDE (' + MID.INCLUDED_COLUMNS + ')', '') AS CREATE_INDEX_STATEMENT

FROM SYS.DM_DB_MISSING_INDEX_GROUP_STATS AS MIGS
INNER JOIN SYS.DM_DB_MISSING_INDEX_GROUPS AS MIG
    ON (MIGS.GROUP_HANDLE = MIG.INDEX_GROUP_HANDLE)
INNER JOIN SYS.DM_DB_MISSING_INDEX_DETAILS AS MID
    ON (MIG.INDEX_HANDLE = MID.INDEX_HANDLE)
ORDER BY 8 DESC
